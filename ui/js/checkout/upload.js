window.addEventListener("smartcut/ready",()=>{jQuery(function(t){t(".single_add_to_cart_button").on("click",async function(i){if(t(this).data("smartcut-upload-complete")){t(this).removeData("smartcut-upload-complete");return}const s=window.smartcutImages||[];if(console.log("Current images:",s),s.length>0){i.preventDefault(),i.stopPropagation();const a=t(this);a.addClass("loading");try{const r=new FormData;s.forEach(n=>{n.files.forEach((e,l)=>{const d=new File([e],n.metadata[l].newName,{type:e.type});r.append("files[]",d)})});const c=await fetch(`${window.smartcutConfig.siteUrl}/wp-json/smartcut/v1/file-upload`,{method:"POST",headers:{"X-WP-Nonce":window.smartcutConfig.nonce},body:r}),o=await c.json();if(c.ok){console.log(o);const n=o.filter(e=>["image/jpeg","image/jpg","image/png"].includes(e.fileType)).map(e=>e.sourceUrl).filter(Boolean);n.length&&t("#smartcut-part-images").val(n.join(","))}else{alert("There was an error uploading images - cannot add to cart"),console.error(o==null?void 0:o.message),a.removeClass("loading");return}a.data("smartcut-upload-complete",!0),a.trigger("click")}catch(r){console.error("Error uploading files:",r),alert("There was an error uploading images - cannot add to cart"),a.removeClass("loading")}}})})});
